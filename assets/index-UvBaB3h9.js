var e=Object.defineProperty,t=(t,s,n)=>((t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n)(t,"symbol"!=typeof s?s+"":s,n);!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class s{constructor(){t(this,"baseUrl"),t(this,"apiKey"),t(this,"sessionId"),this.baseUrl="https://gemini-rag-c8ng.onrender.com/",this.apiKey=localStorage.getItem("rag_api_key"),this.sessionId=localStorage.getItem("rag_session_id"),this.sessionId||(this.sessionId=crypto.randomUUID(),localStorage.setItem("rag_session_id",this.sessionId))}setApiKey(e){this.apiKey=e,localStorage.setItem("rag_api_key",e)}getApiKey(){return this.apiKey}logout(){this.apiKey=null,localStorage.removeItem("rag_api_key")}async checkHealth(){try{return(await fetch(`${this.baseUrl}/`)).ok}catch(e){return!1}}async uploadFile(e){const t=new FormData;t.append("file",e);return(await fetch(`${this.baseUrl}/upload`,{method:"POST",headers:{"X-Api-Key":this.apiKey||"","X-Session-ID":this.sessionId||""},body:t})).json()}async askQuestion(e){return(await fetch(`${this.baseUrl}/ask`,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":this.apiKey||"","X-Session-ID":this.sessionId||""},body:JSON.stringify({question:e})})).json()}}function n(){return Math.random().toString(36).substr(2,9)}function a(){return`session_${n()}_${Date.now()}`}function i(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,e=>t[e])}const o="rag_app_",r={endpoint:`${o}endpoint`,apiKey:`${o}api_key`,sessionId:`${o}session_id`};function l(e){e.API_ENDPOINT&&localStorage.setItem(r.endpoint,e.API_ENDPOINT),e.API_KEY&&localStorage.setItem(r.apiKey,e.API_KEY)}function d(e){localStorage.setItem(r.sessionId,e)}class c{constructor(){t(this,"state"),t(this,"config"),t(this,"listeners",[]),this.config={API_ENDPOINT:localStorage.getItem(r.endpoint)||"http://localhost:5000",API_KEY:localStorage.getItem(r.apiKey)||""};const e=localStorage.getItem(r.sessionId);this.state={sessionId:e||a(),currentDocument:null,isLoading:!1,messages:[],hasDocument:!1},d(this.state.sessionId)}getState(){return{...this.state}}getConfig(){return{...this.config}}setConfig(e){this.config={...this.config,...e},this.notifyListeners()}setDocument(e){this.state.currentDocument=e,this.state.hasDocument=!!e,this.notifyListeners()}getDocument(){return this.state.currentDocument}setLoading(e){this.state.isLoading=e,this.notifyListeners()}addMessage(e,t){this.state.messages.push({id:n(),text:e,sender:t,time:new Date}),this.notifyListeners()}getMessages(){return[...this.state.messages]}clearMessages(){this.state.messages=[],this.notifyListeners()}newSession(){this.state.sessionId=a(),this.state.currentDocument=null,this.state.hasDocument=!1,this.state.messages=[],d(this.state.sessionId),this.notifyListeners()}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){this.listeners.forEach(e=>{e(this.getState(),this.getConfig())})}}class u{static renderDocumentItem(e,t){const s=document.createElement("div");s.className="document-item";const n=document.createElement("div");n.className="document-name",n.textContent=`üìã ${e.name}`;const a=document.createElement("div");a.className="document-meta",a.innerHTML=`\n      <strong>Size:</strong> ${function(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["Bytes","KB","MB","GB"][t]}(e.size)}<br>\n      <strong>Chunks:</strong> ${e.chunks}<br>\n      <strong>Uploaded:</strong> ${e.uploadedAt.toLocaleTimeString()}\n    `;const i=document.createElement("span");if(i.className="badge badge-success",i.textContent="‚úì Ready",s.appendChild(n),s.appendChild(a),s.appendChild(i),t){const e=document.createElement("div");e.className="document-actions";const n=document.createElement("button");n.className="btn btn-danger btn-sm",n.textContent="üóëÔ∏è Remove",n.addEventListener("click",t),e.appendChild(n),s.appendChild(e)}return s}static renderEmptyState(){const e=document.createElement("div");e.className="empty-state";const t=document.createElement("div");t.className="empty-state-icon",t.textContent="üí¨";const s=document.createElement("p");return s.textContent="Upload a document and start asking questions!",e.appendChild(t),e.appendChild(s),e}static renderNoDocuments(){const e=document.createElement("div");return e.className="empty-documents",e.textContent="No documents loaded yet",e}}class h{static formatAIResponse(e){if(!e||"string"!=typeof e)return'<div class="text-paragraph">Unable to display message</div>';let t=i(e);return t=String(t),t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.+?)\*/g,"<em>$1</em>"),t=t.replace(/`([^`]+)`/g,"<code>$1</code>"),t=t.replace(/(\d+)\.\s+([^\n]+)/g,'<div class="list-item numbered-item"><span class="item-number">$1.</span> $2</div>'),t=t.replace(/[-‚Ä¢]\s+([^\n]+)/g,'<div class="list-item bullet-item"><span class="bullet">‚Ä¢</span> $1</div>'),t=t.replace(/\n\n+/g,'</div><div class="text-paragraph">'),t=t.replace(/\n/g,"<br />"),t=`<div class="text-paragraph">${t}</div>`,t=t.replace(/```([\s\S]*?)```/g,'<pre class="code-block"><code>$1</code></pre>'),t}static renderMessage(e){const t=document.createElement("div");t.className=`message ${e.sender}`;const s=document.createElement("div");s.className="message-avatar",s.textContent="user"===e.sender?"You":"AI";const n=document.createElement("div");n.className="message-wrapper";const a=document.createElement("div");a.className="message-content";const o=String(e.text||"");"assistant"===e.sender?a.innerHTML=this.formatAIResponse(o):a.innerHTML=i(o);const r=document.createElement("div");return r.className="message-time",r.textContent=e.time.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),n.appendChild(a),n.appendChild(r),t.appendChild(s),t.appendChild(n),t}static renderLoadingMessage(){const e=document.createElement("div");e.className="message assistant";const t=document.createElement("div");t.className="message-avatar",t.textContent="A";const s=document.createElement("div");s.className="message-wrapper";const n=document.createElement("div");n.className="message-content";const a=document.createElement("div");a.className="loading-dots";for(let i=0;i<3;i++){const e=document.createElement("div");e.className="loading-dot",a.appendChild(e)}return n.appendChild(a),s.appendChild(n),e.appendChild(t),e.appendChild(s),e}static renderStatusMessage(e,t){const s=document.createElement("div");s.className=`status-message ${t}`;const n=document.createElement("span");n.textContent={success:"‚úÖ",error:"‚ùå",info:"‚ÑπÔ∏è",warning:"‚ö†Ô∏è"}[t];const a=document.createElement("span");return a.textContent=e,s.appendChild(n),s.appendChild(a),s}}class m{constructor(){t(this,"stateManager"),t(this,"apiClient"),t(this,"elements",{}),t(this,"currentLoadingMessage",null),this.stateManager=new c;const e=this.stateManager.getConfig();this.apiClient=new s,this.apiClient.setApiKey(e.API_KEY),this.cacheElements(),this.setupEventListeners(),this.render(),this.stateManager.subscribe(()=>this.render())}cacheElements(){["apiEndpoint","apiKey","sessionId","uploadZone","fileInput","documentsList","messagesContainer","questionInput","askBtn","clearBtn","newSessionBtn","statusMessages","settingsBtn"].forEach(e=>{this.elements[e]=document.getElementById(e)})}setupEventListeners(){var e,t,s,n,a,i,o,r,d,c,u,h;null==(e=this.elements.apiEndpoint)||e.addEventListener("change",e=>{const t=e.target.value;this.stateManager.setConfig({API_ENDPOINT:t}),l({API_ENDPOINT:t}),this.showStatus("API endpoint updated","success")}),null==(t=this.elements.apiKey)||t.addEventListener("change",e=>{const t=e.target.value;this.stateManager.setConfig({API_KEY:t}),this.apiClient.setApiKey(t),l({API_KEY:t}),this.showStatus("API key updated","success")}),null==(s=this.elements.uploadZone)||s.addEventListener("click",()=>{var e;null==(e=this.elements.fileInput)||e.click()}),null==(n=this.elements.fileInput)||n.addEventListener("change",e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];s&&(this.handleUpload(s),e.target.value="")}),null==(a=this.elements.uploadZone)||a.addEventListener("dragover",e=>{var t;e.preventDefault(),null==(t=this.elements.uploadZone)||t.classList.add("dragover")}),null==(i=this.elements.uploadZone)||i.addEventListener("dragleave",()=>{var e;null==(e=this.elements.uploadZone)||e.classList.remove("dragover")}),null==(o=this.elements.uploadZone)||o.addEventListener("drop",e=>{var t,s,n;e.preventDefault(),null==(t=this.elements.uploadZone)||t.classList.remove("dragover");const a=null==(n=null==(s=e.dataTransfer)?void 0:s.files)?void 0:n[0];a&&this.handleUpload(a)}),null==(r=this.elements.questionInput)||r.addEventListener("keydown",e=>{if("Enter"===e.key&&!e.shiftKey){e.preventDefault();this.stateManager.getState().isLoading||this.handleQuestion()}}),null==(d=this.elements.askBtn)||d.addEventListener("click",()=>{this.stateManager.getState().isLoading||this.handleQuestion()}),null==(c=this.elements.clearBtn)||c.addEventListener("click",()=>{const e=this.elements.questionInput;e&&(e.value=""),this.stateManager.clearMessages()}),null==(u=this.elements.newSessionBtn)||u.addEventListener("click",()=>{confirm("Start a new session? (Current document will be cleared)")&&(this.stateManager.newSession(),this.render(),this.showStatus("New session created","success"))}),null==(h=this.elements.settingsBtn)||h.addEventListener("click",()=>{this.showSettings()})}async handleUpload(e){this.stateManager.getState();const t=this.stateManager.getConfig();if(!t.API_KEY)return void this.showStatus("Please set your API Key first","error");const s=this.elements.uploadZone,n=null==s?void 0:s.innerHTML;try{this.stateManager.setLoading(!0),s.innerHTML='<div class="spinner"></div>',this.apiClient.setApiKey(t.API_KEY);const n=await this.apiClient.uploadFile(e);this.stateManager.setDocument({name:e.name,size:e.size,uploadedAt:new Date,chunks:n.total_chunks}),this.showStatus(`Document uploaded successfully! (${n.total_chunks} chunks)`,"success"),this.stateManager.clearMessages()}catch(a){this.showStatus(`Upload failed: ${a instanceof Error?a.message:"Unknown error"}`,"error")}finally{this.stateManager.setLoading(!1),s&&(s.innerHTML=n||"")}}async handleQuestion(){var e,t,s;const n=this.stateManager.getState(),a=this.stateManager.getConfig(),i=this.elements.questionInput,o=(null==i?void 0:i.value.trim())||"";if(o)if(n.hasDocument)if(a.API_KEY)try{this.stateManager.setLoading(!0);const t=this.elements.askBtn;t&&(t.disabled=!0),this.stateManager.addMessage(o,"user"),i&&(i.value="");const s=this.elements.messagesContainer;this.currentLoadingMessage=h.renderLoadingMessage(),null==s||s.appendChild(this.currentLoadingMessage),this.scrollToBottom(),this.apiClient.setApiKey(a.API_KEY);const n=await this.apiClient.askQuestion(o);console.log("API Response:",n),null==(e=this.currentLoadingMessage)||e.remove();const r=(null==n?void 0:n.answer)||(null==n?void 0:n.text)||(null==n?void 0:n.response)||"";r&&"string"==typeof r&&r.trim()?this.stateManager.addMessage(r,"assistant"):(console.error("Invalid response format:",n),this.showStatus("Invalid response from API","error"))}catch(r){null==(t=this.currentLoadingMessage)||t.remove(),this.showStatus(`Error: ${r instanceof Error?r.message:"Unknown error"}`,"error")}finally{this.stateManager.setLoading(!1);const e=this.elements.askBtn;e&&(e.disabled=!1),null==(s=this.elements.questionInput)||s.focus()}else this.showStatus("Please set your API Key first","error");else this.showStatus("Please upload a document first","error");else this.showStatus("Please enter a question","error")}render(){this.renderConfig(),this.renderSessionInfo(),this.renderDocuments(),this.renderMessages(),this.updateButtonStates()}renderConfig(){const e=this.stateManager.getConfig(),t=this.elements.apiEndpoint,s=this.elements.apiKey;t&&t.value!==e.API_ENDPOINT&&(t.value=e.API_ENDPOINT),s&&s.value!==e.API_KEY&&(s.value=e.API_KEY)}renderSessionInfo(){const e=this.stateManager.getState(),t=this.elements.sessionId;t&&(t.textContent=e.sessionId,t.title=e.sessionId)}renderDocuments(){const e=this.stateManager.getState(),t=this.elements.documentsList;t&&(t.innerHTML="",e.currentDocument?t.appendChild(u.renderDocumentItem(e.currentDocument)):t.appendChild(u.renderNoDocuments()))}renderMessages(){const e=this.stateManager.getState(),t=this.elements.messagesContainer;t&&(0===e.messages.length?(t.innerHTML="",t.appendChild(u.renderEmptyState())):(t.innerHTML="",e.messages.forEach(e=>{t.appendChild(h.renderMessage(e))}),this.scrollToBottom()))}updateButtonStates(){const e=this.stateManager.getState(),t=this.elements.askBtn,s=this.elements.clearBtn,n=this.elements.questionInput;t&&(t.disabled=e.isLoading||!e.hasDocument),s&&(s.disabled=e.isLoading),n&&(n.disabled=e.isLoading)}showStatus(e,t){const s=this.elements.statusMessages;if(!s)return;const n=h.renderStatusMessage(e,t);s.innerHTML="",s.appendChild(n),setTimeout(()=>{s.contains(n)&&n.remove()},5e3)}showSettings(){const e=this.stateManager.getState(),t=this.stateManager.getConfig();var s,n;alert(`RAG Chat - Settings\n\nAPI Endpoint: ${t.API_ENDPOINT}\nAPI Key: ${t.API_KEY?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢":"Not set"}\nSession ID: ${s=e.sessionId,n=20,s.length<=n?s:s.slice(0,n)+"..."}\n\nUpdate the API endpoint and key in the header to change settings.`)}scrollToBottom(){const e=this.elements.messagesContainer;e&&setTimeout(()=>{e.scrollTop=e.scrollHeight},0)}static initialize(){const e=()=>{new m,console.log("üß† RAG Chat Application initialized")};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}}m.initialize();
//# sourceMappingURL=index-UvBaB3h9.js.map
